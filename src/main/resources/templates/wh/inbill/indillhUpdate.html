<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<html lang="zh-cn">
<head>
    <div th:include="common/headEdit"/>
    <title>修改验货入库信息</title>
</head>
<body>
<div class="panel admin-panel">
    <div class="panel-head" id="add"><strong><span class="icon-pencil-square-o"></span>修改验货入库信息</strong>
    </div>
    <div class="body-content">
        <form method="post" th:action="@{/indillh/updateInbillH}"  class="form-x" id="indillH">
            <table align="center" width="100%" style="border-collapse:separate; border-spacing:0px 10px;">
                <tr>
                    <td style="text-align:right ">
                        <label>入库单号：</label>
                    </td>
                    <td style="text-align:left ">
                        <input type="text" readonly id="inbillcode" name="inbillcode" th:field="${inbillH.inbillcode}"
                               style="line-height: 25px;height: 25px;width: 223px;">
                        <span style="color: red;"></span>
                        <span></span>
                    </td>
                    <td style="text-align:right ">
                        <label>采购单号：</label>
                    </td>
                    <td style="text-align:left ">
                        <input type="text" readonly th:field="${inbillH.oldbill}" name="oldbill"
                               style="line-height: 25px;height: 25px;">
                        <span style="color: red;"></span>
                    </td>
                    <td style="text-align:right ">
                        <label>仓库名称：</label>
                    </td>
                    <td style="text-align:left ">
                        <select name="warecode" th:field="${inbillH.warecode}" class="selectpicker" title="请选择仓库"
                                data-live-search="true" multiple
                                data-max-options="1">
                            <option required th:each="w : ${ware}" th:text="${w.warename}"
                                    th:value="${w.warecode}"></option>
                        </select>
                        <!-- <span th:errors="${whInbillH.warecode}"></span>-->
                    </td>
                </tr>
                <tr>
                    <td style="text-align:right ">
                        <label>供应商：</label>
                    </td>
                    <td style="text-align:left ">
                        <select name="supplyname" th:field="${inbillH.supplyname}" class="selectpicker" title="请选择供应商"
                                data-live-search="true" multiple
                                data-max-options="1">
                            <option th:selected="${inbillH.supplyname == s.servename}" th:each="s : ${serve}" th:text="${s.servename}" th:value="${s.servename}"></option>
                        </select>
                        <span></span>
                    </td>

                    <td style="text-align:right ">
                        <label>客户名称：</label>
                    </td>
                    <td style="text-align:left ">
                        <input type="text" th:field="${inbillH.custname}" style="line-height: 25px;height: 25px;"
                               name="custname">
                    </td>
                    <td style="text-align:right ">
                        <label>运输方式：</label>
                    </td>
                    <td style="text-align:left ">
                        <select name="trantype" th:field="${inbillH.trantype}" class="selectpicker" title="请选择方式">
                            <option value="0">汽车</option>
                            <option value="1">火车</option>
                            <option value="2">转存</option>
                            <option value="3">船运</option>
                        </select>
                        <span></span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:right ">
                        <label>承运商：</label>
                    </td>
                    <td style="text-align:left ">
                        <select name="carrier" th:field="${inbillH.carrier}" class="selectpicker" title="请选择承运商"
                                data-live-search="true" multiple
                                data-max-options="1">
                            <option th:each="t : ${tranunit}" th:text="${t.tranname}" th:value="${t.tranname}"></option>
                        </select>
                        <span></span>
                    </td>
                    <td style="text-align:right ">
                        <label>承运车辆：</label>
                    </td>
                    <td style="text-align:left ">
                        <select id="vehicle" th:field="${inbillH.vehicle}" name="vehicle" class="selectpicker"
                                title="请选择承运车辆" data-live-search="true"
                                multiple data-max-options="1">
                            <option th:each="v : ${vehilce}" th:text="${v.vehicleid}"
                                    th:value="${v.vehicleid}"></option>
                        </select>
                        <span></span>
                    </td>

                    <td style="text-align:right ">
                        <label>送货司机：</label>
                    </td>
                    <td style="text-align:left "><input type="text" id="driver" th:field="${inbillH.driver}"
                                                        style="line-height: 25px;height: 25px;"
                                                        name="driver"></td>
                </tr>
                <tr>
                    <td style="text-align:right ">
                        <label>身份证号：</label>
                    </td>
                    <td style="text-align:left ">
                        <input type="text" id="identifyId" th:field="${inbillH.identifyId}"
                               style="line-height: 25px;height: 25px;"
                               name="identifyId"></td>
                    <td style="text-align:right ">
                        <label>采购合同：</label>
                    </td>
                    <td style="text-align:left ">
                        <input type="text" readonly name="contactbill" th:field="${inbillH.contactbill}"
                               style="line-height: 25px;height: 25px;"
                        >
                        <span style="color: red;"></span>
                        <span></span>
                    </td>
                    <td style="text-align:right ">
                        <label>提单号：</label>
                    </td>
                    <td style="text-align:left ">
                        <input type="text" name="serverbill" th:field="${inbillH.serverbill}"
                               style="line-height: 25px;height: 25px;">
                        <span style="color: red;"></span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:right ">
                        <label>司机电话：</label>
                    </td>
                    <td style="text-align:left ">
                        <input type="text" name="motormanTel" style="line-height: 25px;height: 25px;"
                               th:field="${inbillH.motormanTel}"
                        >
                        <span style="color: red;"></span>
                        <span></span>
                    </td>
                    <td style="text-align:right ">
                        <label>采购类型：</label>
                    </td>
                    <td style="text-align:left ">
                        <select name="purType" th:field="${inbillH.purtype}" class="selectpicker" title="请选择采购类型">
                            <option value="0">合同采购</option>
                            <option value="1">临时采购</option>
                            <option value="2">冲减期初余额</option>
                        </select>
                        <span></span>
                    </td>
                    <td style="text-align:right ">
                        <label>验货人：</label>
                    </td>
                    <td style="text-align:left ">
                        <input type="text" name="tellman" th:field="${inbillH.tellman}" required
                               style="line-height: 25px;height: 25px;">
                        <span style="color: red;"></span>
                    </td>
                </tr>
                <tr>
                    <td style="text-align:right ">
                        <label>发单日期：</label>
                    </td>
                    <td style="text-align:left ">
                        <!--                        <input type="text" name="senddate" style="line-height: 25px;height: 25px;">-->
                        <div class="input-group date form_date col-md-10" style="padding-left:10px" data-date=""
                             data-date-format="" data-link-field="dtp_input1" data-link-format="yyyy-mm-dd">
                            <input type="text" class="input w110" id="senddate" th:field="${inbillH.senddate}"
                                   name="senddate"
                                   data-validate="required:请输入内容"
                                   required>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span> </span>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span> </span>
                        </div>
                        <span style="color: red;"></span>
                    </td>

                    <td style="text-align:right ">
                        <label>入库日期：</label>
                    </td>
                    <td style="text-align:left ">
                        <!--<input type="text" name="indate"
                               style="line-height: 25px;height: 25px;">-->
                        <div class="input-group date form_date col-md-10" style="padding-left:10px" data-date=""
                             data-date-format="" data-link-field="dtp_input1" data-link-format="yyyy-mm-dd">
                            <input type="text" class="input w110" id="indate" name="indate" th:field="${inbillH.indate}"
                                   data-validate="required:请输入内容"
                                   required>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span> </span>
                            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span> </span>
                        </div>
                        <span style="color: red;"></span>
                    </td>
                    <td style="text-align:right ">
                        <label>备注：</label>
                    </td>
                    <td style="text-align:left ">
                        <input type="text" style="line-height: 25px;height: 25px;" name="remark"th:field="${inbillH.remark}"></td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                </tr>
                <tr>
                    <td colspan="4" style="text-align:center ">
                        <!--                        onclick="$('#indillHAdd').submit()"-->
                        <input type="submit" class="button border-main" onclick="$('#indillH').submit()"value="提交" style="padding: 8px 13px;"/>
                        <a class="button border-main" href="/indillh/list" style="padding: 6px 7px;margin-left: 200px">
                            <span class="icon-edit"></span> 返回
                        </a>

                    </td>
                </tr>
            </table>
        </form>
        <form method="post" style="margin-top: 0px" action="" id="indillD">
            <div class="panel admin-panel">
                <div class="panel-head"><strong class="icon-reorder">入库材料信息</strong></div>
                <table class="table table-hover text-center">
                    <tr>
                        <th>序号</th>
                        <th>货物名称</th>
                        <th>品牌</th>
                        <th>发货数量</th>
                        <th>实收数量</th>
                        <th>入库日期</th>
                        <th>操作</th>
                    </tr>
                    <tr th:each="d : ${page.list}">
                        <td  style="text-align:left; padding-left:20px;"><input type="checkbox" name="id[]" th:value="${d.rowno}" />
                            <span th:text="${dStat.index+1}"></span>
                        </td>
                        <td th:text="${d.itemname}">货物名称</td>
                        <td th:text="${d.breadname}"></td>
                        <td th:text="${d.sendNum}">发货数量</td>
                        <td th:text="${d.itemnum}">实收数量</td>
                        <td th:text="${#dates.format(d.whInbillH.indate, 'yyyy-MM-dd')}">入库日期</td>
                        <td>
                            <div>
                                <a class="button border-main" th:href="@{/inbillD/toItemUpdate/(rowno=${d.rowno},id=${id})}" style="padding: 2px 8px;"><span class="icon-edit"></span>修改</a>
                                <a class="button border-red" th:onclick="del([[${d.rowno}]])"  style="padding: 2px 8px;" ><span class="icon-trash-o"></span>删除</a>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td  style="text-align:left; padding:10px 0;padding-left:20px;"><input type="checkbox" id="checkall"/>全选 </td>
                        <td><a class="button border-red" href="javascript:void(0)" style="padding: 2px 8px;" th:onclick="DelSelect()">
                            <span class="icon-trash-o"></span> 批量删除</a></td>
                        <td><a class="button border-main" th:href="@{/indillh/toAddItem/(id=${id})}" style="padding: 2px 8px;" >
                            <span class="icon-plus-square-o"></span> 新增</a>
                        </td>
                    </tr>
                </table>
            </div>
    </form>
</div>
</div>
<script>
    var inbillId = $("#inbillcode").val();
    function del(id){
        if (confirm("您确定要删除吗?")) {
            $.ajax({
                type:"post",
                url:"/inbillD/del/"+id+"/"+inbillId,
                success:function (data) {
                    if(data == "success"){
                        window.location.href="/indillh/toUpdate?id="+inbillId;
                    }
                }
            })
        }
    }
    $("#checkall").click(function(){
        $("input[name='id[]']").each(function(){
            if (this.checked) {
                this.checked = false;
            }
            else {
                this.checked = true;
            }
        });
    })


    //批量删除
    function DelSelect(){
        var ids = "";
        var Checkbox=false;
        $("input[name='id[]']").each(function(){
            if (this.checked==true) {
                ids += this.value + ",";
                Checkbox=true;
            }
        });
        if (Checkbox){
            var t=confirm("您确认要删除选中的内容吗？");
            if (t==false) return false;
            $.ajax({
                type:"post",
                url:"/inbillD/del/" + ids+"/"+inbillId,
                success:function (result) {
                    window.location.href="/indillh/toUpdate?id="+inbillId;
                }
            })
            // $("#listform").submit();
        }
        else{
            alert("请选择您要删除的内容!");
            return false;
        }
    }


    $("#vehicle").change(function () {
        var result = $("#vehicle").val();
        $.ajax({
            url: "/indillh/vehicle/" + result,
            success: function (data) {
                $("#driver").val(data.driver);
                $("#identifyId").val(data.driverid);
            }
        })
    })




    //校验后提交
    /*$("#frm_bbsedit").on("submit", function(ev) {
        //阻止submit表单提交
        ev.preventDefault(
            $.ajax({
                type: "post",
                url: "/bbs/addUptSave?pid=",
                data: $('#frm_bbsedit').serialize(),
                success: function (result) {
                    console.log(result.code);
                    if (result.code) {
                        alert("提交成功");
                        window.location.href = "/bbs/list";
                    } else {
                        // document.getElementById("testid").innerHTML= result.msg;
                        alert("数据提交失败！");
                        return false;
                    }
                },
                error: function (result) {
                    alert("error");
                }})

        );
        return false;
    });*/
    //校验成功后调用公共的提交方法 该方法调试有问题提时屏蔽
    /*  function submitForm() {
          alert("调用submitForm");
          $.ajax({
              type: "post",
              url: "/bbs/addUptSave?pid=",
              data: $('#frm_bbsedit').serialize(),
              success: function (result) {
                  console.log(result.code);
                  alert("返回结果");
                  if (result.code) {
                      alert("提交成功");
                      window.location.href = "/bbs/list";
                  } else {
                      // document.getElementById("testid").innerHTML= result.msg;
                      alert("数据提交失败！");
                      return false;
                  }
              },
              error: function (result) {
                  alert("error");
              }
          })
      }*/
</script>
</body>
</html>